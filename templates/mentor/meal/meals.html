{% extends 'base.html' %}
{% load static %}
{% block title %} Delivery Assignment {% endblock title %}

{% block content %}
<style>
/* Modal Container */
#default-modal {
    display: flex;
    align-items: center;
    justify-content: center;
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
    z-index: 50;
    width: 100%;
    height: calc(100% - 1rem);
    max-height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    background-color: rgba(0, 0, 0, 0.5); /* Optional backdrop */
}

/* Modal Wrapper */
#default-modal > .relative {
    max-width: 600px;
    width: 100%;
    margin: auto;
    padding: 1rem;
}

/* Modal Content */
#default-modal .modal-content {
    background-color: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
}

/* Header */
#default-modal .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    border-bottom: 1px solid #e5e7eb;
}

#default-modal .modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    color: #1f2937;
}

#default-modal .modal-header button {
    background: transparent;
    border: none;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #9ca3af;
    transition: all 0.2s;
}

#default-modal .modal-header button:hover {
    background-color: #f3f4f6;
    color: #374151;
}

/* Body */
#default-modal .modal-body {
    padding: 1rem;
    color: #6b7280;
    line-height: 1.5;
}

/* Footer */
#default-modal .modal-footer {
    display: flex;
    justify-content: flex-end;
    padding: 1rem;
    border-top: 1px solid #e5e7eb;
}

#default-modal .modal-footer button {
    margin-left: 1rem;
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: background-color 0.2s;
}

/* Accept Button */
#default-modal .modal-footer .bg-blue-700 {
    background-color: #1d4ed8;
    color: white;
}

#default-modal .modal-footer .bg-blue-700:hover {
    background-color: #1e40af;
}

/* Decline Button */
#default-modal .modal-footer .border-gray-200 {
    background-color: #fff;
    color: #1f2937;
    border: 1px solid #d1d5db;
}

#default-modal .modal-footer .border-gray-200:hover {
    background-color: #f3f4f6;
    color: #1d4ed8;
}

/* Dark Mode */
.dark #default-modal .modal-content {
    background-color: #374151;
}

.dark #default-modal .modal-header h3 {
    color: #fff;
}

.dark #default-modal .modal-body {
    color: #d1d5db;
}

.dark #default-modal .modal-footer .border-gray-200 {
    background-color: #1f2937;
    border-color: #4b5563;
    color: #d1d5db;
}

.dark #default-modal .modal-footer .border-gray-200:hover {
    background-color: #4b5563;
    color: #fff;
}
..flatpickr-calendar {
    overflow-x: visible;
    overflow-y: visible;
  }
</style>

<div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">
    <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <h2 class="text-title-md2 font-semibold text-black dark:text-white">Daily Food Count</h2>
        {% comment %} <nav>
            <ol class="flex items-center gap-2">
                <li><a class="font-medium" href="{{dashboard}}">Dashboard /</a></li>
                <li class="font-medium text-primary">Delivery Assignment</li>
            </ol>
        </nav> {% endcomment %}
    </div>
    {% comment %} {% for order in orders %} {% endcomment %}
    {% for address, orders in data_by_address.items %}
    <div class="pb-2 mt-4">
        <div class="flex justify-start p-3 container bg-black rounded-lg  mb-2">
            <div class="button flex items-center">
                <p class="inline-flex items-center gap-2 my-1 px-4 py-3 font-medium text-white text-lg hover:bg-opacity-90">
                    <span>{{ address }}</span>
                </p>
            </div>
        </div>

        <div class="rounded-lg border border-stroke bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1">
            <div class="max-w-full overflow-x-auto">
                <table class="w-full table-auto border-collapse border border-gray-300 mb-4">
                    <thead>
                        <tr class="bg-[#F9FAFB] text-left dark:bg-meta-4">
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Day</th>
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Date</th>
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Breakfast</th>
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Lunch</th>
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Snacks</th>
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Dinner</th>
                            <th class="border border-gray-300 py-4 px-4 font-medium text-black dark:text-white bg-gray-200">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders.values %}
                        <tr>
                            <td class="border border-gray-300 px-4 py-2">{{ order.day_name }}</td>
                            <td class="border border-gray-300 px-4 py-2">{{ order.date }}</td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                {{ order.total_breakfast|default_if_none:"-"  }}
                            </td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                {{ order.total_lunch|default_if_none:"-"  }}
                            </td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                {{ order.total_snack|default_if_none:"-"  }}
                            </td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                {{ order.total_dinner|default_if_none:"-"  }}
                            </td>
                            <td class="border border-gray-300 px-4 py-2 text-center">
                                {% if order.is_future == "False" %}
                                <a class="bg-gray-300 text-black px-4 py-2 rounded text-sm cursor-not-allowed"
                                       style="pointer-events: none;">Edit</a>
                                   
                                {% else %}
                                     <a href="{% url 'edit_assign_address' id=order.address_pk date=order.date %}"
                                       class="text-primary px-4 py-2 rounded text-md">Edit</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endfor %}

<!-- Modal toggle -->

  
  <!-- Main modal -->
  {% comment %} <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.css" rel="stylesheet" /> {% endcomment %}
  <!-- SweetAlert2 CSS -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/start/jquery-ui.css"/>

<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script >
    document.querySelector('[data-modal-toggle="default-modal"]').addEventListener('click', () => {
        Swal.fire({
          title: 'Select a Date',
          html: `
            <div class="relative">
              <input
                id="assign-date"
                class="form-datepicker text-black w-full rounded border-[1.5px] border-stroke bg-transparent px-5 py-3 font-normal outline-none transition focus:border-primary active:border-primary dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"
                placeholder="mm/dd/yyyy"
                data-class="flatpickr-right"
              />
              <div class="pointer-events-none absolute inset-0 left-auto right-5 flex items-center">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M15.7504 2.9812H14.2879V2.36245C14.2879 2.02495 14.0066 1.71558 13.641 1.71558C13.2754 1.71558 12.9941 1.99683 12.9941 2.36245V2.9812H4.97852V2.36245C4.97852 2.02495 4.69727 1.71558 4.33164 1.71558C3.96602 1.71558 3.68477 1.99683 3.68477 2.36245V2.9812H2.25039C1.29414 2.9812 0.478516 3.7687 0.478516 4.75308V14.5406C0.478516 15.4968 1.26602 16.3125 2.25039 16.3125H15.7504C16.7066 16.3125 17.5223 15.525 17.5223 14.5406V4.72495C17.5223 3.7687 16.7066 2.9812 15.7504 2.9812ZM1.77227 8.21245H4.16289V10.9968H1.77227V8.21245ZM5.42852 8.21245H8.38164V10.9968H5.42852V8.21245ZM8.38164 12.2625V15.0187H5.42852V12.2625H8.38164V12.2625ZM9.64727 12.2625H12.6004V15.0187H9.64727V12.2625ZM9.64727 10.9968V8.21245H12.6004V10.9968H9.64727ZM13.8379 8.21245H16.2285V10.9968H13.8379V8.21245ZM2.25039 4.24683H3.71289V4.83745C3.71289 5.17495 3.99414 5.48433 4.35977 5.48433C4.72539 5.48433 5.00664 5.20308 5.00664 4.83745V4.24683H13.0504V4.83745C13.0504 5.17495 13.3316 5.48433 13.6973 5.48433C14.0629 5.48433 14.3441 5.20308 14.3441 4.83745V4.24683H15.7504C16.0316 4.24683 16.2566 4.47183 16.2566 4.75308V6.94683H1.77227V4.75308C1.77227 4.47183 1.96914 4.24683 2.25039 4.24683ZM1.77227 14.5125V12.2343H4.16289V14.9906H2.25039C1.96914 15.0187 1.77227 14.7937 1.77227 14.5125ZM15.7504 15.0187H13.8379V12.2625H16.2285V14.5406C16.2566 14.7937 16.0316 15.0187 15.7504 15.0187Z"
                    fill="#64748B"
                  />
                </svg>
              </div>
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: 'Assign',
          cancelButtonText: 'Close',
          customClass: {
            confirmButton: 'bg-success hover:bg-green-600 text-white px-4 py-2 rounded',
            cancelButton: 'bg-danger hover:bg-red-600 text-white px-4 py-2 rounded',
            popup: '.flatpickr-calendar'
          },
          didOpen: () => {
            flatpickr('#assign-date', {
              dateFormat: 'Y-m-d',
            });
          },
          preConfirm: () => {
            const date = document.getElementById('assign-date').value;
            if (!date) {
              Swal.showValidationMessage('Please select a valid date');
              return false;
            }
            return date;
          }
        }).then((result) => {
          if (result.isConfirmed) {
            const date = result.value;
            const url = `/meal-deliveries/edit-assigned-address/${date}/`; // Adjust route if needed
            window.location.href = url;
          }
        });
      });
      
    
  </script>
{% endblock content %}

    

    
      